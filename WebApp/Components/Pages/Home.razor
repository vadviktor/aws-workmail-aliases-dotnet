@page "/"
@rendermode InteractiveServer

<PageTitle>AWS Workmail aliases</PageTitle>

<div class="container mx-auto my-3 px-4">
    <?xml version="1.0"
          encoding="utf-8"?>

    <div class="mb-10 mt-4">
        <svg class="h-12 inline mr-2 w-12"
             fill="none"
             height="800px"
             viewBox="0 -30 150 150"
             width="800px"
             xmlns="http://www.w3.org/2000/svg">
            <path d="M122.714 62.703c5.28-.643 16.924-2.027 18.997.643 2.072 2.621-2.319 13.649-4.293 18.544-.592 1.484.691 2.077 2.023.94 8.684-7.319 10.954-22.6 9.178-24.825-1.777-2.175-17.023-4.055-26.3 2.473-1.431 1.038-1.184 2.423.395 2.225z"
                  fill="#F90" />
            <path d="M74.852 89.456c20.28 0 43.865-6.38 60.099-18.396 2.664-1.978.345-4.994-2.369-3.758-18.207 7.714-37.993 11.473-56.003 11.473-26.694 0-52.5-7.368-73.42-19.533-1.827-1.088-3.208.791-1.679 2.176 19.343 17.505 44.951 28.038 73.372 28.038z"
                  fill="#F90" />
            <path d="M42.632 32.835c0 1.83.197 3.313.542 4.401a26.505 26.505 0 001.58 3.56c.246.396.345.792.345 1.138 0 .495-.296.99-.938 1.484l-3.108 2.077c-.444.296-.889.445-1.283.445-.494 0-.987-.248-1.48-.693a15.29 15.29 0 01-1.777-2.324 38.28 38.28 0 01-1.53-2.918c-3.848 4.55-8.684 6.825-14.506 6.825-4.145 0-7.45-1.187-9.868-3.56-2.418-2.374-3.652-5.54-3.652-9.495 0-4.204 1.48-7.616 4.49-10.187 3.01-2.572 7.007-3.857 12.09-3.857 1.677 0 3.404.148 5.23.395 1.825.248 3.7.643 5.674 1.088v-3.61c0-3.758-.79-6.379-2.32-7.912-1.578-1.533-4.243-2.274-8.042-2.274-1.727 0-3.503.197-5.329.642a39.247 39.247 0 00-5.329 1.682 14.14 14.14 0 01-1.727.643c-.345.098-.592.148-.79.148-.69 0-1.036-.494-1.036-1.533V6.577c0-.791.1-1.385.346-1.73.246-.347.69-.693 1.381-1.04 1.727-.89 3.8-1.631 6.217-2.225C20.23.94 22.797.642 25.51.642c5.872 0 10.164 1.336 12.927 4.006 2.714 2.67 4.096 6.726 4.096 12.165v16.022h.099zm-20.033 7.517c1.628 0 3.306-.297 5.082-.89 1.776-.594 3.355-1.682 4.687-3.165.79-.94 1.382-1.978 1.678-3.165.296-1.187.493-2.621.493-4.302v-2.077a41.135 41.135 0 00-4.539-.84 37.099 37.099 0 00-4.638-.298c-3.306 0-5.724.643-7.352 1.978-1.628 1.336-2.418 3.215-2.418 5.687 0 2.324.592 4.055 1.826 5.242 1.184 1.236 2.911 1.83 5.18 1.83zm39.621 5.34c-.888 0-1.48-.148-1.875-.494-.394-.297-.74-.99-1.036-1.929L47.714 5.044c-.296-.99-.444-1.632-.444-1.978 0-.791.394-1.236 1.184-1.236h4.835c.938 0 1.58.148 1.925.494.395.297.69.99.987 1.929l8.29 32.736 7.697-32.736c.246-.99.542-1.632.937-1.929.395-.297 1.085-.494 1.974-.494h3.947c.938 0 1.579.148 1.974.494.395.297.74.99.937 1.929l7.796 33.132L98.29 4.253c.295-.99.64-1.632.986-1.929.395-.297 1.036-.494 1.925-.494h4.588c.79 0 1.234.395 1.234 1.236 0 .247-.049.494-.099.791a7.041 7.041 0 01-.345 1.236L94.688 43.32c-.297.989-.642 1.631-1.037 1.928-.394.297-1.036.495-1.875.495h-4.243c-.938 0-1.58-.149-1.974-.495-.394-.346-.74-.989-.937-1.978l-7.648-31.895-7.599 31.846c-.247.989-.543 1.632-.938 1.978-.394.346-1.085.494-1.973.494H62.22zm63.405 1.336c-2.566 0-5.132-.297-7.599-.89-2.467-.594-4.391-1.237-5.674-1.979-.79-.445-1.332-.94-1.53-1.384a3.503 3.503 0 01-.296-1.385v-2.522c0-1.038.395-1.533 1.135-1.533.296 0 .592.05.888.148.296.1.74.297 1.234.495a26.791 26.791 0 005.428 1.73c1.973.396 3.898.594 5.871.594 3.109 0 5.527-.544 7.204-1.632 1.678-1.088 2.566-2.67 2.566-4.698 0-1.384-.444-2.521-1.332-3.461-.888-.94-2.566-1.78-4.984-2.571l-7.154-2.226c-3.602-1.137-6.267-2.818-7.895-5.044-1.628-2.176-2.467-4.599-2.467-7.17 0-2.077.444-3.907 1.332-5.489.888-1.582 2.072-2.967 3.553-4.055 1.48-1.137 3.157-1.978 5.131-2.571 1.974-.594 4.046-.841 6.217-.841 1.086 0 2.221.05 3.306.198 1.135.148 2.171.346 3.207.544.987.247 1.925.494 2.813.79.888.298 1.579.594 2.072.891.691.396 1.185.791 1.481 1.236.296.396.444.94.444 1.632V8.16c0 1.039-.395 1.583-1.135 1.583-.395 0-1.036-.198-1.875-.594-2.813-1.285-5.971-1.928-9.474-1.928-2.812 0-5.033.445-6.562 1.384-1.53.94-2.319 2.374-2.319 4.402 0 1.384.493 2.57 1.48 3.51s2.812 1.88 5.427 2.72l7.007 2.226c3.553 1.137 6.118 2.72 7.648 4.747 1.53 2.027 2.27 4.351 2.27 6.923 0 2.126-.444 4.055-1.283 5.736-.888 1.681-2.072 3.165-3.602 4.352-1.53 1.236-3.355 2.126-5.477 2.769-2.22.692-4.54 1.039-7.056 1.039z"
                  fill="#252F3E" />
        </svg>
        <h1 class="font-medium inline text-3xl">
            ikon@vadviktor.xyz has <span class="font-bold">@_aliases?.Count</span> aliases
        </h1>
    </div>

    @if (!string.IsNullOrWhiteSpace(_errorMessage))
    {
        <div class="bg-rose-200 border border-rose-400 border-solid break-all my-5 p-4 rounded-md text-rose-800">
            <i class="fa-solid fa-triangle-exclamation"></i>
            @(new MarkupString(@_errorMessage))
        </div>
    }

    @if (!string.IsNullOrWhiteSpace(_newlyCreatedAlias))
    {
        <div class="bg-lime-200 border border-lime-400 border-solid break-all my-5 p-4 rounded-md text-lime-800">
            <i class="fa-check-square fa-solid"></i>
            <button class="hover:font-bold"
                    @onclick="@(_ => CopyAliasToClipboard(_newlyCreatedAlias))">
                @_newlyCreatedAlias
            </button> has been created successfully
        </div>
    }

    @if (!string.IsNullOrWhiteSpace(_successMessage))
    {
        <div class="bg-lime-200 border border-lime-400 border-solid break-all my-5 p-4 rounded-md text-lime-800">
            <i class="fa-check-square fa-solid"></i>
            @(new MarkupString(@_successMessage))
        </div>
    }

    @if (!string.IsNullOrWhiteSpace(_infoMessage))
    {
        <div class="bg-cyan-200 border border-cyan-400 border-solid break-all my-5 p-4 rounded-md text-cyan-800">
            <i class="fa-info-circle fa-solid"></i>
            @(new MarkupString(_infoMessage))
        </div>
    }


    <EditForm FormName="Alias"
              Model="AliasModel"
              OnValidSubmit="CreateAlias">
        <div class="flex flex-row flex-wrap gap-2">

            <DataAnnotationsValidator />
            <ValidationSummary />

            <InputSelect @bind-Value="AliasModel!.Domain"
                         class="border border-slate-200 border-solid h-14 rounded-md text-gray-500"
                         required>
                <option selected
                        value="">
                    -- Select a domain --
                </option>

                @foreach (var domain in _domains ?? Enumerable.Empty<string>())
                {
                    <option value="@domain">@domain</option>
                }
            </InputSelect>

            <div class="relative">
                <InputText @bind-Value="AliasModel!.Mailbox"
                           class="block border-slate-200 focus:border-blue-600 h-14 pb-2.5 peer/mailbox pt-5 px-2.5 rounded-md text-gray-900 text-sm w-80"
                           id="mailbox"
                           placeholder=" "
                           required
                           type="text" />
                <label class="absolute peer-placeholder-shown/mailbox:scale-100 scale-75 start-2.5 text-gray-500 text-sm top-4 z-10
                      -translate-y-4 duration-300 origin-[0] peer-focus/mailbox:-translate-y-4 peer-focus/mailbox:scale-75 peer-focus/mailbox:text-blue-600 peer-placeholder-shown/mailbox:translate-y-0 transform"
                       for="mailbox">
                    Mailbox alias
                </label>
            </div>

            <div class="relative">
                <input @bind="_aliasLength"
                       class="block border-slate-200 focus:border-blue-600 h-14 pb-2.5 peer/length pt-5 px-2.5 rounded-md shrink-0 text-gray-900 text-sm w-24"
                       id="mailbox-alias-length"
                       max="32"
                       min="8"
                       placeholder=" "
                       type="number" />
                <label class="absolute peer-placeholder-shown/length:scale-100 scale-75 start-2.5 text-gray-500 text-sm top-4 z-10
                       -translate-y-4 duration-300 origin-[0] peer-focus/length:-translate-y-4 peer-focus/length:scale-75 peer-focus/length:text-blue-600 peer-placeholder-shown/length:translate-y-0 transform"
                       for="mailbox-alias-length">
                    Alias length
                </label>
            </div>

            <button class="align-middle border border-slate-500 focus:outline focus:outline-4 focus:outline-slate-300 group h-14 hover:bg-slate-500 hover:text-white px-4 rounded-lg text-slate-500"
                    @onclick="GenerateRandomAlias"
                    type="button">
                <i class="fa-shuffle fa-solid fa-xl fill-slate-500 group-hover:fill-white"></i>
                <span>Randomize</span>
            </button>
        </div>

        <button class="align-middle bg-sky-500 block border border-sky-500 h-14 hover:bg-sky-600 hover:border-sky-600 mt-5 mx-auto px-4 rounded-lg text-white"
                type="submit">
            <i class="fa-at fa-solid fa-xl"></i>
            <span>Create</span>
        </button>
    </EditForm>

    @if (_aliases?.Any() == false)
    {
        <pre class="text-lg">Loading...</pre>
    }
    else
    {
        <div class="mt-10">
            @foreach (var alias in (_aliases ?? Enumerable.Empty<string>()).Select((value, index) => new
                      {
                          Value = value,
                          Index = index
                      }))
            {
                var backgroundClass = alias.Index % 2 == 0 ? "bg-neutral-100" : string.Empty;
                var aliasParts = alias.Value.Split('@');
                var mailbox = aliasParts[0];
                var domain = aliasParts[1];

                <div class="@backgroundClass flex gap-2 items-center p-4"
                     @key="alias.Value">
                    <button class="bg-slate-900 h-10 hover:bg-slate-700 px-4 rounded-lg text-white"
                            @onclick="@(_ => CopyAliasToClipboard(alias.Value))">
                        <i class="fa-clipboard fa-solid"></i>
                        <span class="hidden md:inline text-nowrap">Copy to clipboard</span>
                    </button>
                    <span class="break-all flex-1">
                        @mailbox<span class="font-bold">@@@domain</span>
                    </span>

                    @if (!string.IsNullOrWhiteSpace(_showDeleteChoicesFor) &&
                         _showDeleteChoicesFor == alias.Value)
                    {
                        <button class="bg-red-200 h-10 hover:bg-red-500 hover:text-white px-4 rounded-lg text-neutral-500"
                                @onclick="@(_ => DeleteAlias(alias.Value))"
                                type="button">
                            Yes
                        </button>

                        <button class="bg-slate-500 font-bold h-10 hover:bg-slate-400 px-4 rounded-lg text-white"
                                @onclick="() => _showDeleteChoicesFor = string.Empty"
                                type="button">
                            No
                        </button>
                    }
                    else
                    {
                        <button class="bg-rose-500 h-10 hover:bg-rose-700 px-4 rounded-lg text-white"
                                @onclick="@(_ => _showDeleteChoicesFor = alias.Value)"
                                type="button">
                            <i class="fa-solid fa-trash-can"></i>
                            <span class="hidden md:inline">Delete</span>
                        </button>
                    }
                </div>
            }
        </div>
    }
</div>